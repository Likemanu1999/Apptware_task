<div class="animated fadeIn">

	<div class="row" *ngIf="  payableExit && !generatePiFlag">
		<div class="col-md-12">
			<div class="card">
				<div class="card-header">
					<h4>

						<div class="row">
							<div class="col-md-6">
								<i class="fa fa-handshake-o"></i> Local Purchase Contracts
							</div>

							<div class="col-md-3">
								<button class="btn btn-primary  pull-right" *ngIf="add_opt" (click)="addNew()"><i
										class="fa fa-plus"></i> Local Purchase Deal</button>
							</div>

							<div class="col-md-2">
								<button class="btn btn-danger pull-right" *ngIf="manufacture_deal"
									(click)="addManufecturer()"><i class="fa fa-plus"></i> Manufacturer Deal</button>
							</div>
						</div>


					</h4>

				</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-12">
							<div class="row">
								<div class="col-md-12">
								    <div class="form-inline" style="display: flex;
									  justify-content: space-evenly;
									  margin-bottom: 10px;">
										<div class="form-group">
											<label for=""><b> Deal Date:</b></label>
											<div class="input-group mx-sm-3">
												<input type="text" class="form-control " bsDaterangepicker [bsConfig]="datePickerConfig" #dp="bsDaterangepicker"
													[maxDate]="maxDate" [(ngModel)]="bsRangeValue" (ngModelChange)="clearDropdown (); onchangeDate()"
													placeholder="From Date - To Date" readonly> &nbsp; &nbsp;
												<app-dropdown-daterange (dateEvent)="receiveDate($event)"
													[uploadSuccess]="uploadSuccess"></app-dropdown-daterange>
											</div>
										</div>
								
										<div class="form-group">
											<label for="" class="font-weight-bold">Lifting Status:</label>
											<div class="form-group mx-sm-3">
												<ng-select placeholder="Lifting Status" [searchable]="true" [clearable]="true" bindLabel="label"
													bindValue="id" [items]="status" [(ngModel)]="lifting_status" (change)="onSelect($event,'2')">
												</ng-select>
											</div>
										</div>								
										<div class="form-group">
											<label for="" class="font-weight-bold">Payment Status: </label>
											<div class="form-group mx-sm-3">
												<ng-select placeholder="Lifting Status" [searchable]="true" [clearable]="true" bindLabel="label"
													bindValue="id" [items]="status" [(ngModel)]="payment_status" (change)="onSelect($event,'3')">
												</ng-select>
											</div>
										</div>
								
										<div class="form-group">
											<button class="btn btn-primary" (click)="generate_pi()" [disabled]="!checkstatus">
												<i class="fa fa-file"></i> Generate	PI
											</button>
										</div>

									</div>
								</div>								
	


								<div class="col-md-12">
									<p-table #dt [value]="deal_list" dataKey="id" styleClass="ui-table-purchase"
										[rowHover]="true" [rows]="10" [showCurrentPageReport]="true" [scrollable]="true"
										scrollHeight="400px" [rowsPerPageOptions]="[10,25,50]" [paginator]="false" [loading]="isLoading"
										[columns]="selectedColumns" (onFilter)="onFilter($event, dt)"
										[globalFilterFields]="['deal_date','sub_org_name','port_name','godown_name','marketing_person','grade_name','maingradename','quantity','rate','due_date','remark','deliveryTerm','vendor_ref_number','id']">
										<ng-template pTemplate="caption">
											<div class="row">
												<div class="col-md-12">
													<div class="ui-helper-clearfix" style="text-align: left">
														<button type="button" *ngIf="excel_download" pButton
															icon="pi pi-file-excel" iconPos="left"
															(click)="exportExcel()" style="margin-right: 0.5em;"
															class="ui-button-success"></button>
														<button *ngIf="pdf_download" type="button" pButton
															icon="pi pi-file-pdf" iconPos="left"
															(click)="exportPdf()" class="ui-button-warning"></button>
														<button type="button" pButton icon="pi pi-envelope"
															iconPos="left" label="Lift/Pay Mail"
															class="ui-button-warning" (click)="sendMail()"></button>
														<button class="btn btn-success" (click)="knockoff()"
															*ngIf="knockOff"><i class="fa fa-arrow-right"></i>Knock of
															Payment</button>
													</div>
													<div style="margin-top: -30px;">
													<p-multiSelect [options]="cols" [(ngModel)]="selectedColumns"
														optionLabel="header" selectedItemsLabel="{0} columns selected"
														[style]="{minWidth: '200px'}" defaultLabel="Choose Columns">
													</p-multiSelect>
												</div>
												</div>
													</div>				
												<div class="row">
													<div class="col-md-12">
														<div class="row">
															<div class="col-md-3">
																<ng-select placeholder="Company " [searchable]="true"
																	[clearable]="true" *ngIf="company_filter" bindLabel="label"
																	bindValue="id" [items]="company" [(ngModel)]="company_id"
																	style="font-size: 10px;" (change)="onSelect($event,'4')">
																</ng-select>
															</div>
			
															<div class="col-md-3">
																<ng-select placeholder="Deal Type " [searchable]="true"
																	[clearable]="true" bindLabel="label" *ngIf="manufacture_deal"
																	bindValue="id" [items]="dealType" [(ngModel)]="deal_type"
																	style="font-size: 10px;" (change)="getDealList()">
																</ng-select>
															</div>
		
															<div class="col-md-4">
																<input pInputText class='form-control' type="text"
																	(input)="dt.filterGlobal($event.target.value, 'contains')"
																	placeholder="Global Search" />
															</div>
														</div>
													</div>
													</div>
												
										</ng-template>

										<ng-template pTemplate="header" let-columns>


											<tr>
												<th style="width: 3rem" *ngIf=" selectedColumns.length > 0">
													<p-tableHeaderCheckbox (click)="onCheckAll(a.checked)" #a>
													</p-tableHeaderCheckbox>
												</th>


												<th *ngIf="lifting_details  && selectedColumns.length > 0"
													style="width:90px">Lifting Details
												</th>
												<th *ngIf="selectedColumns.length > 0  || edit_opt  || del_opt || cancel_qty || local_godown_allocation"
													style="width:120px">Actions</th>

												<th [style.width]="col.style" pSortableColumn="{{col.field}}"
													*ngFor="let col of columns"
													[ngClass]="col.field == 'sub_org_name' ? 'sticky-col second-col' : ''">
													{{col.header}} <p-sortIcon field="{{col.field}}"></p-sortIcon>
												</th>
												<th *ngIf="send_sms  && selectedColumns.length > 0" style="width:90px">
													Whatsapp/Email</th>


											</tr>

											<tr>
												<th></th>
												<th *ngIf="lifting_details && selectedColumns.length > 0"></th>
												<th
													*ngIf="selectedColumns.length > 0  || edit_opt  || del_opt || cancel_qty || local_godown_allocation">
												</th>
												
												<th *ngIf="getColumnPresent('deal_date')">
													<input type="text" class="form-control" [(ngModel)]="deal_date"
														(ngModelChange)="onDateSelect($event,'deal_date')"
														[bsConfig]="{ dateInputFormat: 'YYYY-MM-DD', containerClass: 'theme-blue' }"
														#dp="bsDatepicker" bsDatepicker placeholder="Search by Date">
												</th>
												<th *ngIf="getColumnPresent('id')"></th>

												<th class="sticky-col second-col"
													*ngIf=" getColumnPresent('sub_org_name')">
													<div *ngIf="supplier_list.length > 0">
														<p-multiSelect [options]="supplier_list" placeholder="All"
															appendTo="body" (onChange)="onchange($event,'sub_org_name')"
															optionLabel='sub_org_name'>
															<ng-template let-op pTemplate="item">

																<span>&#123;&#123;op.label&#125;&#125;</span>

															</ng-template>
														</p-multiSelect>
													</div>
												</th>
												<th *ngIf="getColumnPresent('quantity')"></th>
												<th *ngIf="getColumnPresent('rate')"></th>
												<th *ngIf="getColumnPresent('deal_value_gst')"></th>
												<th *ngIf="getColumnPresent('payment_done')"></th>
												<th *ngIf="getColumnPresent('payment_remaining')">
													<input type="text" class="form-control"
														(keyup)="CheckForValue($event,'payment_remaining')">
												</th>

												<th *ngIf=" getColumnPresent('status_payment')">
												</th>
												<th *ngIf="getColumnPresent('PaymentTermName')"></th>
												<th *ngIf="getColumnPresent('due_date')">
													<input type="text" class="form-control" [(ngModel)]="due_date"
														(ngModelChange)="onDateSelect($event,'due_date')"
														[bsConfig]="{ dateInputFormat: 'YYYY-MM-DD', containerClass: 'theme-blue' }"
														#dp="bsDatepicker" bsDatepicker placeholder="Search by Date">
												</th>

												<th *ngIf="getColumnPresent('mode_of_payment')"></th>

												<th *ngIf="getColumnPresent('lifting_done')"></th>
												<th *ngIf="getColumnPresent('lifting_remaining')"></th>

												<th *ngIf="getColumnPresent('status_lift')">


												</th>
												<th *ngIf=" getColumnPresent('maingradename')">
													<div *ngIf="grade_type.length > 0 ">
														<p-multiSelect [options]="grade_type" placeholder="All"
															appendTo="body"
															(onChange)="onchange($event,'maingradename')"
															optionLabel="maingradename">
															<ng-template let-option pTemplate="item">

																<span>&#123;&#123;option.label&#125;&#125;</span>

															</ng-template>
														</p-multiSelect>
													</div>
												</th>


												<th *ngIf="getColumnPresent('grade_name')">
													<div *ngIf="grades.length > 0 ">
														<p-multiSelect [options]="grades" placeholder="All"
															appendTo="body" (onChange)="onchange($event,'grade_name')"
															optionLabel="grade_name">
															<ng-template let-option pTemplate="item">

																<span>&#123;&#123;option.label&#125;&#125;</span>

															</ng-template>
														</p-multiSelect>
													</div>
												</th>
												<th *ngIf="getColumnPresent('productname')"></th>
												<th *ngIf="getColumnPresent('godown_name')">
													<div *ngIf="godown.length > 0">
														<p-multiSelect [options]="godown" placeholder="All"
															appendTo="body" (onChange)="onchange($event,'godown_name')"
															optionLabel="godown_name">
															<ng-template let-opt pTemplate="item">

																<span>{{opt.label}}</span>

															</ng-template>
														</p-multiSelect>
													</div>
												</th>


												<th *ngIf="getColumnPresent('marketing_person')">
													<div *ngIf="zones.length > 0 ">
														<p-multiSelect [options]="zones" placeholder="All"
															appendTo="body"
															(onChange)="onchange($event,'marketing_person')"
															optionLabel="marketing_person">
															<ng-template let-opt pTemplate="item">

																<span>{{opt.label}}</span>

															</ng-template>
														</p-multiSelect>
													</div>
												</th>
												<th *ngIf="getColumnPresent('remark')"></th>
												<th *ngIf="getColumnPresent('deliveryTerm')"></th>
												<th *ngIf="getColumnPresent('delivery_remark')"></th>
												<th *ngIf="getColumnPresent('eta')"></th>
												<!-- <th *ngIf="getColumnPresent('all_purchase_invc')"></th>-->
												<th *ngIf="send_sms  && selectedColumns.length > 0"></th>

											</tr>
										</ng-template>
										<ng-template pTemplate="body" let-item let-columns>

											<tr class="ui-selectable-row">

												<td *ngIf=" selectedColumns.length > 0" style="width:  3rem;">
													<input type="checkbox" [value]="item" #inputs #checkboxes
														(click)="onCheck(checkboxes.checked,item)">
												</td>

												<td *ngIf="lifting_details  && selectedColumns.length > 0"
													style="width:  90px;">
													<button class="btn btn-sm btn-success"
														(click)="getLiftingDetails(item)">Lifting</button>
													<div *ngIf="item.lifting_original_doc_status"> <b
															style="font-size: 10px;color: seagreen;">Original
															Received</b> </div>
													<div *ngIf="!item.lifting_original_doc_status"> <b
															style="font-size: 10px;color: red;">Original Pending...</b>
													</div>
													<div *ngIf="item.lifting_scan_doc_status"> <b
															style="font-size: 10px;color:blueviolet;">Scan
															Copy Received</b> </div>
													<div *ngIf="!item.lifting_scan_doc_status"> <b
															style="font-size: 10px;color:saddlebrown;">Scan
															Copy Pending...</b> </div>
												</td>

												<td *ngIf=" selectedColumns.length > 0" style="width: 120px;">
													<span *ngIf="edit_opt && item.status_lift == 0"><button
															pTooltip="Edit Deal" tooltipPosition="top"
															class="btn btn-sm btn-primary" (click)="onEdit(item)"><i
																class="fa fa-pencil"></i></button></span>
													<span
														*ngIf="del_opt && item.status_lift == 0 && item.payment_remaining > 0 ">
														<button class="btn btn-sm btn-danger" mwlConfirmationPopover
															pTooltip="Delete Deal" tooltipPosition="top"
															[popoverTitle]="popoverTitle"
															[popoverMessage]="popoverMessage"
															[confirmText]="confirmText" [cancelText]="cancelText"
															[placement]="placement"
															[closeOnOutsideClick]="closeOnOutsideClick"
															confirmButtonType="danger" cancelButtonType="success"
															(confirm)="onDelete(item)"
															(cancel)="cancelClicked = true"><i class="fa fa-trash"
																style="color: white;"></i></button></span>
													<span *ngIf="payment_details">
														<button class="btn btn-sm btn-warning"
															(click)="paymentModule(item)"
															*ngIf="findInarray(item.mode_of_payment, 1) "
															pTooltip="Payment" tooltipPosition="top"
															placeholder="top"><i class="fa fa-rupee"></i></button>
													</span>
													<span *ngIf="cancel_qty ">

														<button *ngIf="(item.quantity-item.lifting_done) <= 50 "
															class="btn btn-sm btn-danger" (click)="cancelQty(item)"
															[pTooltip]="item.quantity-item.lifting_done"
															tooltipPosition="top" placeholder="top"><i
																class="fa fa-close"></i></button>

														<button class="btn btn-sm btn-success"
															(click)="onAddExtraQty(item)" pTooltip="Add Qty"
															tooltipPosition="top" placeholder="top"><i
																class="fa fa-plus"></i> </button>




														<button *ngIf=" item.status_lift == 0 "
															class="btn btn-sm btn-primary" (click)="splitQty(item)"
															pTooltip="Split Quantity" tooltipPosition="top"
															placeholder="top"><i class="fa fa-expand"></i></button>

														<button class="btn btn-sm btn-danger"
															(click)="knockOfQuantity(item)"
															pTooltip="Knock of  Quantity" tooltipPosition="top"
															placeholder="top"><i class="fa fa-minus"></i> </button>
													</span>
													<span>
														<button *ngIf="item.LocalPurchaseLiftingDetails.length>0 "
															class="btn btn-sm btn-dark" (click)="onLiftingShow(item)"
															pTooltip="Lifting Details" tooltipPosition="top"
															placeholder="top"><i class="fa fa-eye"></i> </button>
														<button
															*ngIf="(item.delivery_term_id == 2 || item.delivery_term_id == 3 ) && local_godown_allocation"
															class="btn btn-sm btn-secondary"
															(click)="godown_allocation(item.id)"
															pTooltip="Godown Allocation" tooltipPosition="top"
															placeholder="top"><i class="fa fa-truck"></i> </button>
													</span>
													<span *ngIf="changeMode"><button class="btn btn-sm btn-warning"
															(click)="updateMode(item)" pTooltip="Change Mode Of Payment"
															tooltipPosition="top" placeholder="top"><i
																class="fa fa-credit-card"></i> </button> </span>
												</td>
											
												<td *ngIf="getColumnPresent('deal_date')" style="width:  150px;">
													<span class="ui-column-title">Booking Date</span>
													{{item.deal_date | date: 'dd-MM-y E'}}
													<br><button class="btn btn-success btn-sm" *ngIf="add_charges"
														(click)="charges(item.id)">Add
														Charges</button>
												</td>
												<td *ngIf="getColumnPresent('id')" style="width:  150px;">
													<span class="ui-column-title">Booking ID</span>
													{{item.id}}
												</td>

												<td class="sticky-col second-col"
													*ngIf="getColumnPresent('sub_org_name')" style="width:  220px;">
													<span class="ui-column-title">Supplier</span>
													{{item.sub_org_name}}

													<span *ngIf="item.po_copy"><a [href]="item.po_copy"
															target="_blank"><span class="badge badge-primary"> <em
																	class="fa fa-file"></em> PO Copy</span></a></span>
													<div *ngIf="item.vendor_ref_number" style="color:rebeccapurple;">
														(Ref No.
														{{item.vendor_ref_number}})</div>

												</td>

												<td *ngIf="getColumnPresent('quantity')" style="width:  100px;">
													<span class="ui-column-title">Quantity</span>
													{{item.quantity}} MT
												</td>

												<td *ngIf="getColumnPresent('rate')" style="width:  150px;">
													<span class="ui-column-title">Rate/Term</span>
													{{item.rate}}/ {{getTerm(item.term)}}
												</td>
												<td *ngIf="getColumnPresent('deal_value_gst')" style="width:  100px;">
													<span *ngIf="item.deal_value == null; else elseBlock">                          
														0                     
													</span>
													  <ng-template #elseBlock>
														{{item.deal_value_gst | currencyInr}}
														<div
														*ngIf="item.other_credit_amount > 0 || item.short_credit_amount > 0 || item.damage_credit_amount > 0 ">
														<span style="color: crimson; font-size: 9px;">Amount Debited:
															{{item.other_credit_amount +
															item.short_credit_amount +
															item.damage_credit_amount}}</span>
													</div>
													  </ng-template>
												</td>

												<td *ngIf="getColumnPresent('payment_done')" style="width:  100px;">
													<span class="ui-column-title">Payment Done</span>
													<span [pTooltip]="item.payment_done_msg" tooltipPosition="top"
														placeholder="top">
														{{item.payment_done}}
													</span>

												</td>

												<td *ngIf="getColumnPresent('payment_remaining')"
													style="width:  150px;">
													<span class="ui-column-title">Payment Remaining</span>
													{{roundToTwo(item.payment_remaining)}}
													<div *ngIf="item.payment_remaining < 0"><button type="button"
															class="btn btn-sm btn-success"
															(click)="adjustModalOpen(item)">Adjust</button></div>
												</td>
												<td *ngIf="getColumnPresent('status_payment')" style="width:  100px;">
													<span class="ui-column-title">Payment Status</span>
													<span
														[class]="'customer-badge status-'+item.status_payment">{{getstatus(item.payment_remaining)}}</span>
												</td>


												<td *ngIf="getColumnPresent('PaymentTermName')" style="width:  200px;">
													<span class="ui-column-title">Payment Term</span>
													{{item.PaymentTermName}}
												</td>

												<td *ngIf="getColumnPresent('due_date')" style="width:  150px;">
													<span class="ui-column-title">Due Date</span>
													{{item.due_date| date: 'dd-MM-y '}}
												</td>
												<td *ngIf="getColumnPresent('mode_of_payment')" style="width:  120px;">
													<span class="ui-column-title">Mode Of Payment</span>
													{{item.modeOfPaymentName}}
												</td>

												<td *ngIf="getColumnPresent('lifting_done')" style="width:  100px;">
													<span class="ui-column-title">Lifting Done</span>
													{{item.lifting_done}}
												</td>
												<td *ngIf="getColumnPresent('lifting_remaining')"
													style="width:  100px;">
													<span class="ui-column-title">Lifting Remaining</span>
													{{item.lifting_remaining}}
												</td>
												<td *ngIf="getColumnPresent('status_lift')" style="width:  100px;">
													<span class="ui-column-title">Lifting Status</span>
													<span
														[class]="'customer-badge status-'+item.status_lift">{{getstatus(item.status_lift)}}</span>
												</td>
												<td *ngIf="getColumnPresent('maingradename')" style="width:  180px;">
													<span class="ui-column-title">Grade</span>
													{{item.maingradename}}
												</td>

												<td *ngIf="getColumnPresent('grade_name')" style="width:  180px;">
													<span class="ui-column-title">Grade in Detail</span>
													{{item.grade_name}}
												</td>
												<td *ngIf="getColumnPresent('productname')" style="width:  180px;">
													<span class="ui-column-title">Product Name</span>
													{{item.productname}}
												</td>
												<td *ngIf="getColumnPresent('godown_name')" style="width:  180px;">
													<span class="ui-column-title">Godown</span>
													{{item.godown_name}}
												</td>
												<td *ngIf="getColumnPresent('marketing_person')" style="width:  180px;">
													<span class="ui-column-title">Zone</span>
													{{item.marketing_person}}
												</td>
												<td *ngIf="getColumnPresent('remark')" style="width:  150px;">
													<span class="ui-column-title">Remark</span>
													{{item.remark}}
												</td>
												<td *ngIf="getColumnPresent('deliveryTerm')" style="width:  150px;">
													<span class="ui-column-title">Delivery Term</span>
													{{item.deliveryTerm}}
												</td>
												<td *ngIf="getColumnPresent('delivery_remark')" style="width:  150px;">
													<span class="ui-column-title">Delivery Remark</span>
													{{item.delivery_remark}}
												</td>
												<td *ngIf="getColumnPresent('eta')" style="width:  150px;">
													<span class="ui-column-title">ETA</span>
													{{item.eta}}
												</td>
												<td *ngIf="send_sms  && selectedColumns.length > 0"
													style="width:  90px;">
													<button class="btn btn-sm btn-primary"
														(click)="whatsappDetails(item)"><i class="fa fa-whatsapp"></i> /
														<i class="fa fa-envelope"></i> </button>
												</td>
											</tr>
										</ng-template>

										<ng-template pTemplate="footer">
											<tr>
												<td *ngIf=" selectedColumns.length > 0" style="width: 3rem;"></td>
												<td *ngIf="lifting_details  && selectedColumns.length > 0"
													style="width: 90px;"></td>

												<td *ngIf="selectedColumns.length > 0  || edit_opt  || del_opt || cancel_qty || local_godown_allocation"
													style="width: 120px;"></td>

												<td *ngIf="getColumnPresent('deal_date')" style="width: 150px;">Total
												</td>
												<td *ngIf="getColumnPresent('sub_org_name')" style="width: 220px;"></td>
												<td *ngIf="getColumnPresent('quantity')" style="width: 100px;">
													{{roundToTwo(tot_qty)}}
												</td>
												<td *ngIf="getColumnPresent('rate')" style="width: 150px;">
													{{roundToTwo(tot_rate)}}
												</td>
												<td *ngIf="getColumnPresent('deal_value_gst')" style="width: 100px;">
													{{roundToTwo(tot_deal_val)| currencyInr}}
												</td>

												<td *ngIf="getColumnPresent('payment_done')" style="width: 100px;">
													{{roundToTwo(totalPaymentDone) | currencyInr}}</td>
												<td *ngIf="getColumnPresent('payment_remaining')" style="width: 150px;">
													{{roundToTwo(totalPaymentRemaining) |
													currencyInr}}</td>
												<td *ngIf="getColumnPresent('status_payment')" style="width: 100px;">
												</td>
												<td *ngIf="getColumnPresent('PaymentTermName')" style="width: 200px;">
												</td>
												<td *ngIf="getColumnPresent('due_date')" style="width: 150px;"></td>
												<td *ngIf="getColumnPresent('mode_of_payment')" style="width: 120px;">
												</td>
												<td *ngIf="getColumnPresent('lifting_done')" style="width: 100px;">
													{{roundToTwo(tot_lifting_done)}}</td>
												<td *ngIf="getColumnPresent('lifting_remaining')" style="width: 100px;">
													{{roundToTwo(tot_lifting_remaining)}}</td>
												<td *ngIf="getColumnPresent('status_lift')" style="width: 100px;"></td>
												<td *ngIf="getColumnPresent('maingradename')" style="width: 180px;">
												</td>
												<td *ngIf="getColumnPresent('grade_name')" style="width: 180px;"></td>
												<td *ngIf="getColumnPresent('productname')" style="width: 180px;"></td>
												<td *ngIf="getColumnPresent('godown_name')" style="width: 180px;"></td>
												<td *ngIf="getColumnPresent('marketing_person')" style="width: 180px;">
												</td>

												<td *ngIf="getColumnPresent('remark')" style="width: 150px;"></td>
												<td *ngIf="getColumnPresent('deliveryTerm')" style="width: 150px;"></td>
												<td *ngIf="getColumnPresent('delivery_remark')" style="width: 150px;">
												</td>
												<td *ngIf="getColumnPresent('eta')" style="width: 150px;"></td>

												<td *ngIf="send_sms  && selectedColumns.length > 0"
													style="width: 90px;"></td>

											</tr>
											<tr>
												<td colspan="15" style="text-align:left">Total Records:
													{{filteredValuess?.length}}</td>
											</tr>
										</ng-template>
										<ng-template pTemplate="emptymessage">
											<tr>
												<td colspan="8" style="text-align:left">No Data found.</td>
											</tr>
										</ng-template>
									</p-table>



								</div>




								<div class="col-md-8 text-center mt-3" *ngIf="localSummaryPayment.length && !isLoading">
									<table class="table table-bordered">
										<thead>
											<tr>
												<th>#</th>
												<th>Supplier</th>
												<th>Payment Remaining</th>
												<th>Advance With Supplier</th>
											</tr>

										</thead>
										<tbody>
											<tr *ngFor="let item of localSummaryPayment ; let index = index">
												<td>{{index+1}}</td>
												<td>{{item.sub_org_name}}</td>
												<td>{{item.payment_remaining | currencyInr}}</td>
												<td>{{item.advanvce_with_sup | currencyInr}}</td>
											</tr>
										</tbody>
										<tfoot>

											<tr>
												<td></td>
												<td><b>Total</b></td>
												<td><b>{{TotalRemain | currencyInr}}</b></td>
												<td><b>{{TotalAdvance | currencyInr }}</b></td>

											</tr>

										</tfoot>
									</table>
								</div>





							</div>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- <app-lifting-details [lifitng_details_arr]="liftingDetails" *ngIf="!hideShow && payableExit"
		(emitFunctionOfParent)="backFromLifting($event)"></app-lifting-details> -->
</div>
<app-payable-request [initialPara]="payablePara" *ngIf="payablePara" (payableBack)="backFromPayable($event)">
</app-payable-request>






<app-generate-pi *ngIf="generatePiFlag" [deal_arr]="dealArrayForPI" [mode]="mode"
	(emitFunctionOfPi)="BackFromPi($event)"></app-generate-pi>






<div bsModal #myModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
	aria-hidden="true" [config]="{backdrop:'static'}">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<form [formGroup]="addPurchaseForm" novalidate (ngSubmit)="onSubmit()" autocomplete="off">

				<div class="modal-header">
					<h4 class="modal-title">Local Purchase Deal </h4>
					<button type="button" class="close" (click)=" oncloseModal()" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>

				<div class="modal-body">
					<p style="color: red;" *ngIf="unsoldTotalMessage">IMPORTANT : CAN NOT ADD NEW PURCHASE DEAL!!<br>
						Current Total Unsold {{totalAmt | number :
						'1.2-3'}} MT, Maximum Allowed Limit {{fixedValue}} MT</p>

					<div class="row">
						<div  class="col-md-12">
							<div class="form-group">
								<div class="ui-g">
									<div class="ui-g-6">
										<p-radioButton name="is_forward" formControlName="is_forward" value="1"
											label="Forward Deal"></p-radioButton>
									</div>
									<div class="ui-g-6">
										<p-radioButton name="is_forward" formControlName="is_forward" value="0"
											label="Spot Deal"></p-radioButton>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="company_id">Company</label> <span
									style="color: red ; font-size:6px"><i class="fa fa-asterisk "></i></span>
								<ng-select id="company_id" formControlName="company_id" placeholder="Select  "
									[searchable]="true" [clearable]="true" bindLabel="label" bindValue="id"
									[items]="company" (click)="pvcUnsoldTotal()">
								</ng-select>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label class="col-form-label" for="purchase_holder_id">Zone</label> <span
									style="color: red ; font-size:6px"><i class="fa fa-asterisk "></i></span>
								<ng-select id="purchase_holder_id" formControlName="purchase_holder_id"
									placeholder="Select Zone Name" [searchable]="true" [clearable]="true"
									bindLabel="first_name" bindValue="id" [items]="zone">
								</ng-select>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label class="col-form-label" for="godown_id">Godown</label> <span
									style="color: red ; font-size:6px"><i class="fa fa-asterisk "></i></span>
								<ng-select id="godown_id" formControlName="godown_id" placeholder="Select Godown"
									[searchable]="true" [clearable]="true" bindLabel="godown_name" bindValue="id"
									[items]="godownList">
								</ng-select>
							</div>
						</div>

						<div class="col-md-8">
							<div class="form-group">
								<label class="col-form-label" for="supplier_id">Supplier Name</label> <span
									style="color: red ; font-size:6px"><i class="fa fa-asterisk "></i></span>

								<ng-select id="supplier_id" formControlName="supplier_id"
									placeholder="Select Supplier Name" [searchable]="true" [clearable]="true"
									bindLabel="sub_org_name" bindValue="sub_org_id" [items]="sub_org"
									(change)="onChangeSupplier($event)" (click)="pvcUnsoldTotal()">
									<ng-template ng-option-tmp let-item="item">
										<div title="{{item.sub_org_name}}">{{item.sub_org_name}}
										</div>
									</ng-template>
								</ng-select>
							</div>
						</div>

						<div class="col-md-4">
							<div class="form-group">
								<label class="col-form-label" for="grade_id">Grade</label> <span
									style="color: red ; font-size:6px"><i class="fa fa-asterisk "></i></span>
								<ng-select id="grade_id" formControlName="grade_id" placeholder="Select Grade "
									[searchable]="true" [clearable]="true" bindLabel="grade_name" bindValue="grade_id"
									[items]="grade_list">

									<ng-template ng-option-tmp let-item="item">
										<div title="{{item.grade_name}}">{{item.grade_name}}
										</div>
									</ng-template>
								</ng-select>

							</div>
						</div>

						<div class="col-md-4">
							<div class="form-group">
								<label class="col-form-label" for="deal_date">Booking Date</label> <span
									style="color: red ; font-size:6px"><i class="fa fa-asterisk "></i></span>
								<input type="text" class="form-control" id="deal_date" formControlName="deal_date"
									[bsConfig]="{ dateInputFormat: 'YYYY-MM-DD', containerClass: 'theme-blue', startView:'day', minView:'day' }"
									#dp="bsDatepicker" bsDatepicker readonly placeholder="Enter Deal Date "
									style="background-color: white;">
							</div>
						</div>

						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="due_date">Due Date</label>
								<input type="text" class="form-control" id="due_date" formControlName="due_date"
									[bsConfig]="{ dateInputFormat: 'YYYY-MM-DD', containerClass: 'theme-blue' }"
									#dp="bsDatepicker" bsDatepicker readonly placeholder="Enter Due Date "
									style="background-color: white;">
							</div>
						</div>

						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="quantity">Deal Quantity (MT)</label> <span
									style="color: red ; font-size:6px"><i class="fa fa-asterisk "></i></span>
								<input type="text" class="form-control" id="quantity" formControlName="quantity"
									placeholder="Enter Deal Quantity" numbersOnly (keyup)="onchangeQuantity()">
							</div>
						</div>


						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="rate">Deal Rate</label> <span
									style="color: red ; font-size:6px"><i class="fa fa-asterisk "></i></span>
								<input type="text" class="form-control" id="rate" formControlName="rate"
									placeholder="Enter Deal Rate " numbersOnly (keyup)="onchangeQuantity()">
							</div>
						</div>

						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="rate">Deal Value GST</label>
								<input type="text" class="form-control" id="deal_value_gst"
									formControlName="deal_value_gst" numbersOnly readonly>
							</div>
						</div>

						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="term">Term</label> <span
									style="color: red ; font-size:6px"><i class="fa fa-asterisk "></i></span>
								<ng-select id="term" formControlName="term" placeholder="Select Term "
									[searchable]="true" [clearable]="true" bindLabel="label" bindValue="id"
									[items]="term">
								</ng-select>
							</div>
						</div>




						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="delivery_term">Delivery Term </label> <span
									style="color: red ; font-size:6px"><i class="fa fa-asterisk "></i></span>

								<ng-select id="delivery_term" formControlName="delivery_term"
									placeholder="Select Delivery Term" [searchable]="true" [clearable]="true"
									bindLabel="term" bindValue="id" [items]="delivery_term">
									<ng-template ng-option-tmp let-item="item">
										<div title="{{item.term}}">{{item.term}}</div>
									</ng-template>
								</ng-select>
							</div>
						</div>




						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="freight">Freight</label>
								<input type="text" class="form-control" id="freight" formControlName="freight"
									placeholder="Enter  freight " numbersOnly
									[readonly]="delivery == 1 || delivery == null || delivery == undefined ">
							</div>
						</div>




						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="mode_of_payment">Mode Of Payment</label> <span
									style="color: red ; font-size:6px"><i class="fa fa-asterisk "></i></span>
								<ng-select id="mode_of_payment" formControlName="mode_of_payment"
									placeholder="Select Term " [searchable]="true" [clearable]="true" bindLabel="label"
									bindValue="id" [items]="paymentMethod" [multiple]=true>
								</ng-select>
							</div>
						</div>




						<div class="col-md-6">
							<div class="form-group">
								<label class="col-form-label" for="payment_term">Payment Term</label> <span
									style="color: red ; font-size:6px"><i class="fa fa-asterisk "></i></span>
								<ng-select id="payment_term" formControlName="payment_term"
									placeholder="Select Payment Term" [searchable]="true" [clearable]="true"
									bindLabel="pay_term" bindValue="pt_id" [items]="paymentTerm" [multiple]=true>
								</ng-select>
							</div>
						</div>





						<div class="col-md-4">
							<div class="form-group">
								<label class="col-form-label" for="remark">Remark</label>
								<textarea class="form-control" id="remark" formControlName="remark"
									placeholder="Enter Remark "></textarea>
							</div>
						</div>
						<div class="col-md-4">
							<div class="form-group">
								<label class="col-form-label" for="delivery_remark">Delivery Remark</label>
								<textarea class="form-control" id="remark" formControlName="delivery_remark"
									placeholder="Enter Remark "></textarea>
							</div>
						</div>
						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="eta">ETA</label>
								<input type="text" class="form-control" id="eta" formControlName="eta"
									[bsConfig]="{ dateInputFormat: 'YYYY-MM-DD', containerClass: 'theme-blue' }"
									#dp="bsDatepicker" bsDatepicker readonly placeholder="Enter ETA Date"
									style="background-color: white;">
							</div>
						</div>

						<input type="hidden" class="form-control" formControlName="cgst_percent">
						<input type="hidden" class="form-control" formControlName="sgst_percent">
						<input type="hidden" class="form-control" formControlName="tcs_percent">
					</div>

					<div class="row">
						<div class="col-md-6 col-sm-12">
							<div class="input-group">
								<input type="email" #newEmailValue id="input2-group2" name="input2-group2"
									class="form-control" placeholder=" Add New Email" autocomplete="email">
								<span class="input-group-append">
									<button type="button" class="btn btn-primary"
										(click)="addNewEmails(newEmailValue.value);newEmailValue.value=''">Add</button>
								</span>
							</div>
						</div>

						<div class="col-md-6 col-sm-12">
							<div class="input-group">
								<input type="number" id="input2-group2" #newMobileValue name="input2-group2"
									class="form-control" placeholder="Add New Mobile Number (10 Digit )"
									autocomplete="email">
								<span class="input-group-append">
									<button type="button" class="btn btn-primary"
										(click)="addNewMobileNumbers(newMobileValue.value); newMobileValue.value=''">Add</button>
								</span>
							</div>
						</div>
					</div>


					<div class="row m-1">

						<div class="col">

							<p-chips formControlName="emailMult" separator=",">
							</p-chips>

						</div>


						<div class="col">
							<p-chips formControlName="mobileMult" separator=",">
							</p-chips>
						</div>


					</div>


				</div>



				<div class="modal-footer">
					<button class="btn btn-primary mr-1" type="submit"
						[disabled]="addPurchaseForm.pristine || addPurchaseForm.invalid || loadingBtn">
						<i class="fa fa-dot-circle-o"></i>Submit

						<i class="fa fa-spinner fa-spin" *ngIf="loadingBtn"></i>

					</button>
				</div>
			</form>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->




<div bsModal #myModalManufacturer="bs-modal" class="modal fade" tabindex="-1" role="dialog"
	aria-labelledby="myModalLabel" aria-hidden="true" [config]="{backdrop:'static'}">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<form [formGroup]="addManufacturerForm" novalidate (ngSubmit)="onSubmitManufacturer()" autocomplete="off">

				<div class="modal-header">
					<h4 class="modal-title">Manufacturer Deal </h4>
					<button type="button" class="close" (click)=" oncloseModalManufacturer()" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>

				<div class="modal-body">


					<div class="row">


						<div class="col-md-8">
							<div class="form-group">
								<label class="col-form-label" for="supplier_id">DCA/CS <span
										style="color: red ; font-size:5px"><i
											class="fa fa-asterisk "></i></span></label>

								<ng-select id="supplier_id" formControlName="supplier_id" placeholder="Select"
									[searchable]="true" [clearable]="true" bindLabel="sub_org_name"
									bindValue="sub_org_id" [items]="manufacturer"
									(change)="onChangeManufacturer($event) ">
									<ng-template ng-option-tmp let-item="item">
										<div title="{{item.sub_org_name}}">{{item.sub_org_name}}
										</div>
									</ng-template>
								</ng-select>




							</div>
						</div>

						<div class="col-md-4">
							<div class="form-group">
								<label class="col-form-label" for="godown_id">Godown <span
										style="color: red ; font-size:5px"><i
											class="fa fa-asterisk "></i></span></label>
								<ng-select id="godown_id" formControlName="godown_id" placeholder="Select Godown"
									[searchable]="true" [clearable]="true" bindLabel="godown_name" bindValue="id"
									[items]="godownList">
								</ng-select>
							</div>
						</div>

						<div class="col-md-4">
							<div class="form-group">
								<label class="col-form-label" for="grade_id">Grade <span
										style="color: red ; font-size:5px"><i
											class="fa fa-asterisk "></i></span></label>
								<ng-select id="grade_id" formControlName="grade_id" placeholder="Select Grade "
									[searchable]="true" [clearable]="true" bindLabel="grade_name" bindValue="grade_id"
									[items]="petro_manufacturer_grade">
									<ng-template ng-option-tmp let-item="item">
										<div title="{{item.grade_name}}">{{item.grade_name}}
										</div>
									</ng-template>
								</ng-select>
							</div>
						</div>

						<div class="col-md-4">
							<div class="form-group">
								<label class="col-form-label" for="deal_date">Booking Date <span
										style="color: red ; font-size:5px"><i
											class="fa fa-asterisk "></i></span></label>
								<input type="text" class="form-control" id="deal_date" formControlName="deal_date"
									[bsConfig]="{ dateInputFormat: 'YYYY-MM-DD', containerClass: 'theme-blue' }"
									#dp="bsDatepicker" bsDatepicker readonly placeholder="Enter Deal Date "
									style="background-color: white;">
							</div>
						</div>



						<div class="col-md-4">
							<div class="form-group">
								<label class="col-form-label" for="quantity">Vendor Ref Number</label>
								<input type="text" class="form-control" id="vendor_ref_number"
									formControlName="vendor_ref_number" placeholder="Vendor Reference Number ">
							</div>
						</div>


						<div class="col-md-6">
							<div class="form-group">
								<label class="col-form-label" for="payment_term">Payment Term <span
										style="color: red ; font-size:5px"><i
											class="fa fa-asterisk "></i></span></label>
								<ng-select id="payment_term" formControlName="payment_term"
									placeholder="Select Payment Term" [searchable]="true" [clearable]="true"
									bindLabel="pay_term" bindValue="pt_id" [items]="paymentTerm" [multiple]=true>
								</ng-select>
							</div>
						</div>


						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="delivery_term">Delivery Term </label>
								<ng-select id="delivery_term" formControlName="delivery_term"
									placeholder="Select Delivery Term" [searchable]="true" [clearable]="true"
									bindLabel="term" bindValue="id" [items]="delivery_term">
								</ng-select>
							</div>
						</div>

						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="term">Term</label>
								<ng-select id="term" formControlName="term" placeholder="Select Term "
									[searchable]="true" [clearable]="true" bindLabel="label" bindValue="id"
									[items]="term">
								</ng-select>
							</div>
						</div>


						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="mode_of_payment">Mode Of Payment</label>
								<ng-select id="mode_of_payment" formControlName="mode_of_payment"
									placeholder="Select Term " [searchable]="true" [clearable]="true" bindLabel="label"
									bindValue="id" [items]="paymentMethod" [multiple]=true>
								</ng-select>
							</div>
						</div>



						<div class="col-md-12">
							<table class="table table-bordered">


								<tbody>
									<tr>
										<th>Qty (MT)</th>
										<th>(A)</th>
										<th> <input type="text" class="form-control" id="quantity"
												formControlName="quantity" placeholder="Enter Deal Quantity "
												numbersOnly (keyup)="calculateManufacturerDealValue()"
												(change)="calculateManufacturerDealValue()"></th>
									</tr>

									<tr>
										<th>Basic Rate</th>
										<th>(B)</th>
										<th> <input type="text" class="form-control" id="rate" formControlName="rate"
												placeholder="Enter Deal Rate " numbersOnly
												(keyup)="calculateManufacturerDealValue()"
												(change)="calculateManufacturerDealValue()"></th>
									</tr>

									<tr>
										<th>Add: Freight</th>
										<th>(c)</th>
										<th> <input type="text" class="form-control" id="freight"
												formControlName="freight" placeholder="Enter Freight " numbersOnly
												(keyup)="calculateManufacturerDealValue()"
												(change)="calculateManufacturerDealValue()"></th>
									</tr>

									<tr>
										<th>Less: Cash Discount</th>
										<th>(D)</th>
										<th> <input type="text" class="form-control" id="less_cash_discount"
												formControlName="less_cash_discount" placeholder="Enter Discount "
												numbersOnly (keyup)="calculateManufacturerDealValue()"
												(change)="calculateManufacturerDealValue()"></th>
									</tr>

									<tr>
										<th>Less: MOU Discount</th>
										<th>(E)</th>
										<th> <input type="text" class="form-control" id="less_mou_discount"
												formControlName="less_mou_discount" placeholder="Enter Discount "
												numbersOnly (keyup)="calculateManufacturerDealValue()"
												(change)="calculateManufacturerDealValue()"></th>
									</tr>


									<tr>
										<th>Less: Other Discount</th>
										<th>(F)</th>
										<th> <input type="text" class="form-control" id="less_other_discount"
												formControlName="less_other_discount" placeholder="Enter Discount "
												numbersOnly (keyup)="calculateManufacturerDealValue()"
												(change)="calculateManufacturerDealValue()"></th>
									</tr>

									<tr>
										<th>Invoice Rate</th>
										<th>(G) = (B+C-D-E-F)</th>
										<th> <input type="text" class="form-control" id="basic_rate"
												formControlName="basic_rate" numbersOnly
												(keyup)="calculateManufacturerDealValue()"
												(change)="calculateManufacturerDealValue()"></th>
									</tr>

									<tr>
										<th>Basic Amount</th>
										<th>(H) = (A*G)</th>
										<th> <input type="text" class="form-control" id="basic_amount"
												formControlName="basic_amount" numbersOnly
												(keyup)="calculateManufacturerDealValue()"
												(change)="calculateManufacturerDealValue()"></th>
									</tr>

									<tr>
										<th>GST Amount</th>
										<th>(I) = (H * {{gst_percentege}}%)</th>
										<th> <input type="text" class="form-control" id="gst_amount"
												formControlName="gst_amount" numbersOnly
												(keyup)="calculateManufacturerDealValue()"
												(change)="calculateManufacturerDealValue()"></th>
									</tr>
									<tr>
										<th>Invoice Value </th>
										<th>(J) = (H + I)</th>
										<th> <input type="text" class="form-control" id="invoice_amount"
												formControlName="invoice_amount" numbersOnly
												(keyup)="calculateManufacturerDealValue()"
												(change)="calculateManufacturerDealValue()"></th>
									</tr>

									<tr>
										<th> TDS/TCS </th>
										<th>(K) = H * {{tds_percent}}%</th>
										<th> <input type="text" class="form-control" id="tds_amount"
												formControlName="tds_amount" numbersOnly
												(keyup)="calculateManufacturerDealValue()"
												(change)="calculateManufacturerDealValue()"></th>
									</tr>


									<tr>
										<th> To be Paid </th>
										<th>(J - K)</th>
										<th> <input type="text" class="form-control" id="deal_value"
												formControlName="deal_value" numbersOnly
												(keyup)="calculateManufacturerDealValue()"
												(change)="calculateManufacturerDealValue()"></th>
									</tr>

								</tbody>
							</table>
						</div>






						<div class="col-md-4">
							<div class="form-group">
								<label class="col-form-label" for="remark">Remark</label>
								<textarea class="form-control" id="remark" formControlName="remark"
									placeholder="Enter Remark "></textarea>
							</div>
						</div>


					</div>

				</div>

				<div class="modal-footer">
					<button class="btn btn-primary mr-1" type="submit"
						[disabled]="addManufacturerForm.pristine || addManufacturerForm.invalid || loadingBtn">
						<i class="fa fa-dot-circle-o"></i>Submit

						<i class="fa fa-spinner fa-spin" *ngIf="loadingBtn"></i>

					</button>
				</div>
			</form>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->





<div bsModal #myExtraModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
	aria-hidden="true" [config]="{backdrop:'static'}">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<form [formGroup]="addExtraPurchaseForm" novalidate (ngSubmit)="onExtraSubmit()" autocomplete="off">

				<div class="modal-header">
					<h4 class="modal-title">Local Purchase Deal- Extra Qty Add </h4>
					<button type="button" class="close" (click)=" oncloseModal()" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>

				<div class="modal-body">


					<div class="row">

						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="extra_quantity">Extra Deal Quantity</label>
								<input type="text" class="form-control" id="extra_quantity"
									formControlName="extra_quantity" placeholder="Enter Extra Deal Quantity "
									numbersOnly>
							</div>
						</div>
					</div>
				</div>



				<div class="modal-footer">
					<button class="btn btn-primary mr-1" type="submit">
						<i class="fa fa-dot-circle-o"></i>Submit</button>
				</div>
			</form>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #sendWhatappModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
	aria-hidden="true" [config]="{backdrop:'static'}">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">

			<div class="modal-header">
				<h4 class="modal-title">Send Whatsapp Message </h4>
				<button type="button" class="close" aria-label="Close" (click)="onCloseSms()">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<div class="modal-body">
				<div *ngIf="isLoadingSMS" style="text-align: center;">
					<app-loading-spinner></app-loading-spinner>
				</div>

				<div class="row">
					<div class="col-md-12">


						<div class="row m-1">

							<div class="col">
								<label class="col-form-label" for="">Email</label>
								<p-chips [(ngModel)]="toEmailArr" separator=",">
								</p-chips>

							</div>


							<div class="col">
								<label class="col-form-label" for="">Contact</label>
								<p-chips [(ngModel)]="toWhatsappArr" separator=",">
								</p-chips>
							</div>


						</div>



						<div [innerHTML]="messageText"></div>

					</div>

				</div>



			</div>



			<div class="modal-footer">
				<button class="btn btn-primary mr-1" type="button" (click)="sendSMS()"
					[disabled]="toEmailArr.length == 0 &&toWhatsappArr.length == 0 ">
					<i class="fa fa-dot-circle-o"></i>Submit</button>
			</div>

		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<toaster-container [toasterconfig]="toasterconfig"></toaster-container>


<div bsModal #myModalMail="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
	aria-hidden="true" [config]="{backdrop:'static'}">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">


			<div class="modal-header">
				<h4 class="modal-title">Lifting And Payment Details</h4>
				<button type="button" class="close" (click)="closeModal()" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<div class="modal-body">
				<div *ngIf="isLoadingMail" style="text-align: center;">
					<app-loading-spinner></app-loading-spinner>
				</div>
				<div class="row">
					<div class="col-md-12">
						<div *ngIf="checkedList.length>0">
							<div class="row">
								<div class="col-md-6">
									<p> <strong>To</strong> : <span *ngFor="let email of maillist"><input
												type="checkbox" (click)="mailto(b.checked,email)" #b> {{email}} <br>
										</span></p>
									<p><textarea class="form-control" cols="6" [(ngModel)]="tomailtext "
											(change)='tomailvalue($event)'>}</textarea></p>
								</div>
								<div class="col-md-6">
									<p> <strong>Cc</strong> : <span *ngFor="let email of maillist"><input
												type="checkbox" (click)="ccmail(c.checked,email)" #c> {{email}} <br>
										</span></p>
									<p><textarea class="form-control" cols="6" [(ngModel)]="ccmailtext "
											(change)='ccmailvalue($event)'></textarea></p>
									<p>Put Additional Email comma seperated</p>
								</div>
							</div>


							<p>Dear {{checkedList[0].sub_org_name}},</p>
							<p>Greetings from Sushila Parmar International Pvt Ltd.</p>
							<p>We have entered into the below mentioned purchase transaction/s with your valued
								organization, the
								details of the same are as below;</p>

							<p>Select Lifting <input type="checkbox" #chk (click)="selectLifting(chk.checked)"> </p>
							<p>Select Payament <input type="checkbox" #chk1 (click)="selectPayament(chk1.checked)"> </p>

							<div class="col-md-12" *ngIf="lifting_list">
								<h4>Lifting Details</h4>
								<div *ngFor="let item of checkedList">

									<h5 *ngIf="item.LocalPurchaseLiftingDetails.length">Con ID: {{item.id}} , Quantity:
										{{item.quantity}}
										MT , Rate: {{item.rate}} , Grade: {{item.grade_name}} , Destination:
										{{item.godown_name}}</h5>
									<table class="table table-striped table-hover table-responsive-lg"
										[mfData]="item.LocalPurchaseLiftingDetails" #mf2="mfDataTable"
										*ngIf="item.LocalPurchaseLiftingDetails.length">
										<thead>
											<tr>
												<th>Sr.No</th>
												<th>Invoice No.</th>
												<th>Invoice Date.</th>
												<th>Truck No</th>
												<th>Quantity Lift</th>

											</tr>
										</thead>
										<tbody>

											<tr *ngFor="let val of mf2.data; let i = index" [attr.data-index]="i"
												[attr.id]="val.id">

												<td>{{i+1}}</td>
												<td>{{val.purchase_invoice_no}} </td>
												<td>{{val.purchase_invoice_date | date: 'dd/MM/yyyy'}} </td>
												<td>{{val.truck_no}} </td>
												<td>{{val.quantity}} MT </td>

											</tr>
										</tbody>

									</table>




								</div>

							</div>



							<div class="col-md-12" *ngIf="payment_list">
								<h4>Payment Details</h4>

								<div *ngFor="let item of checkedList">

									<h5 *ngIf="item.LocalPurchasePaymentDetails.length">Con ID: {{item.id}} , Quantity:
										{{item.quantity}}
										MT , Rate: {{item.rate}} , Grade: {{item.grade_name}} , Destination:
										{{item.godown_name}}</h5>
									<table class="table table-striped table-hover table-responsive-lg"
										[mfData]="item.LocalPurchasePaymentDetails" #mf3="mfDataTable"
										*ngIf="item.LocalPurchasePaymentDetails.length">
										<thead>
											<tr>
												<th>Sr.No</th>
												<th>Paid Date</th>
												<th>Paid Amount.</th>
												<th>UTR NO</th>

											</tr>
										</thead>
										<tbody>

											<tr *ngFor="let val of mf3.data; let i = index" [attr.data-index]="i"
												[attr.id]="val.id">

												<td>{{i+1}}</td>
												<td>{{val.paid_date | date: 'dd/MM/yyyy'}} </td>
												<td>{{val.paid_amount | currencyInr}} </td>
												<td>{{val.utr_no}} </td>

											</tr>
										</tbody>

									</table>


								</div>


							</div>

							<p>**Disclaimer - The above information is for your information only and should not be
								considered final
								for all legal purposes.
								Note :Please contact us immediately if you find any discrepancies in the above
								information provided by
								us. Kindly contact your purchase manager OR parmar@parmarglobal.com for details /
								clarifications if any.
							</p>
							<p>Request you to kindly note the above at your end. </p>
							<p>Regards,</p>
							<p>SPIPL</p>


						</div>
					</div>


				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
					<button type="button" class="btn btn-primary" (click)="composeMail()">Send Mail</button>
				</div>

			</div><!-- /.modal-content -->
		</div><!-- /.modal-dialog -->
	</div><!-- /.modal -->
</div>







<div bsModal #myModalAdjust="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
	aria-hidden="true" [config]="{backdrop:'static'}">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">

			<div class="modal-header">
				<h4 class="modal-title">Local Purchase Deal </h4>
				<button type="button" class="close" (click)="closeAdjust()" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<div class="modal-body">


				<div class="row">

					<div class="col-md-12">
						<h3 class="text-center">{{ supplierAdjust}}</h3>
						<h3>Adjust Amount : {{paymentRemain}}</h3>
						<form [formGroup]="adjustForm" autocomplete="off" (ngSubmit)="submitArray()">
							<div style="overflow: scroll">
								<table class="table table-bordered">
									<thead>
										<tr>
											<th>Booking Date</th>
											<th>Name</th>
											<th>Deal Value</th>
											<th>Remaining Amount</th>
											<th>Adjust Amount</th>


										</tr>
									</thead>

									<tbody>
										<tr formArrayName="adjustDeals"
											*ngFor="let item of adjustDealsList ; let i = index">
											<ng-container [formGroupName]=i>

												<td>
													{{ item.deal_date | date: 'dd-MM-y E'}}
													<br> ({{item.id}})

												</td>
												<td>{{item.sub_org_name}}</td>
												<td>{{item.deal_value_gst}} </td>
												<td>{{item.payment_remaining}}</td>
												<td>
													<input class="form-control" formControlName="amount" numbersOnly
														type="text"
														(keyup)="checkForAmount($event.target.value , item.payment_remaining , i)">

													<input class="form-control" formControlName="id" numbersOnly
														type="hidden">
												</td>
											</ng-container>
										</tr>
									</tbody>
								</table>
								<div class="row mt-5">
									<div class="col text-center">
										<button class="btn btn-primary mr-1" type="submit">
											<em class="fa fa-dot-circle-o"></em>Submit</button>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
			<div class="modal-footer">
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div bsModal #myModalPayment="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
	aria-hidden="true" [config]="{backdrop:'static'}">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<form [formGroup]="invoiceAmountForm" novalidate autocomplete="off">
				<div class="modal-header">
					<h4>Balance Amount : {{paymentRemain | currencyInr}} <br>
					Division Balance : {{totalAmtLocal | currencyInr}}</h4>
					<button type="button" class="close" (click)="closePayment()" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="row">
						<div class="col-md-2">
							<input type="radio" #deal name="payment_against" value="1"
								(click)="CheckPaymentAgainst($event)">
							<strong>Deal</strong>
						</div>
						<div class="col-md-2">
							<input type="radio" #invoice name="payment_against" value="2"
								(click)="CheckPaymentAgainst($event)">
							<strong>Invoices</strong>
						</div>
					</div>
					<div class="row">
						<div class="col-md-8">
							<div class="form-group">
								<label class="col-form-label" for="supplier_id"><strong>Supplier Name</strong></label>

								<ng-select id="supplier_id" placeholder="Select Supplier Name" [searchable]="true"
									[clearable]="true" bindLabel="sub_org_name" bindValue="sub_org_id"
									[items]="sister_company_list">
									<ng-template ng-option-tmp let-item="item">
										<div title="{{item.sub_org_name}}">{{item.sub_org_name}}
										</div>
									</ng-template>
								</ng-select>
							</div>
						</div>
					</div>
					<div class="row" *ngIf="paymentInvoice">
						<div class="col-md-6">
							<div class="form-group">
								<label class="col-form-label" for=""><strong>Invoice</strong></label>

								<ng-select id="supplier_id" placeholder="Select" [searchable]="true" [clearable]="true"
									bindLabel="purchase_invoice_no" bindValue="id" [items]="lifting_invoices"
									(change)="selectInvoice($event)" [multiple]="true">
									<ng-template ng-option-tmp let-item="item">
										<div title="{{item.purchase_invoice_no}}">{{item.purchase_invoice_no}}
										</div>
									</ng-template>
								</ng-select>
							</div>
						</div>
						<div class="col-md-3 form-group">
							<label class="col-form-label"><strong>Amount</strong></label>
							<input type="text" class="form-control" formControlName="amount" numbersOnly
								placeholder="Enter Amount" (keyup)="CheckForInvoiceAmt()">
							<span *ngIf="totalAmtExceed" style="color: red;">Payment Cannot be Done</span>
						</div>
						<div class="col-md-6">
							<div class="form-group">
							  <label class="col-form-label" for="bank_id">To Bank</label>
							  <ng-select id="bank_id" placeholder="Select Bank Name" [searchable]="true" [clearable]="true"
								 bindLabel="bankName" bindValue="bank_id" [items]="bank_list"
								formControlName="bank_id">
							  </ng-select>
							</div>
						  </div>
						  <div class="col-md-4">
							<div class="form-group">
							  <label class="col-form-label" for="remark">Remark</label>
							  <input formControlName="remark" class="form-control" placeholder="Enter Remark if any">
							</div>
						  </div>
					</div>
					<div class="row col-md-12">
						<button class="btn btn-primary mr-1" type="button" *ngIf="proccedBtn"
							(click)="proceedPayment()" >Proceed <i class="fa fa-arrow-right"></i></button>
					</div>
				</div>
				<div class="modal-footer"></div>
			</form>

		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->



<div bsModal #myLiftingDetails="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
	aria-hidden="true" [config]="{backdrop:'static'}">
	<div class="modal-dialog modal-xl" role="document">
		<div class="modal-content">

			<div class="modal-header">
				<h4 class="modal-title">Local Lifting Details - {{liftingText}}</h4>
				<button type="button" class="close" (click)=" oncloseModal()" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<div class="modal-body">


				<div class="row">

					<table class="table table-striped table-hover table-responsive-lg">
						<thead>
							<tr>
								<th>#</th>
								<th>Quantity</th>
								<th>Truck No.</th>
								<th>Grade</th>
								<th>Invoice No.</th>
								<th>Invoice Date</th>
								<th>Short Qty</th>
								<th>Damage Qty</th>
								<th>Purchase Rate</th>
								<th>Remark</th>
							</tr>
						</thead>
						<tbody>

							<tr *ngFor="let elem_lift of lifting_data; let i = index">
								<td>{{i+1}}</td>
								<td>{{elem_lift.quantity}}</td>
								<td>{{elem_lift.truck_no}}</td>
								<td>{{elem_lift.grade_name}}</td>
								<td>{{elem_lift.purchase_invoice_no}}</td>
								<td>{{elem_lift.purchase_invoice_date}}</td>
								<td>{{elem_lift.short_material_qty}}</td>
								<td>{{elem_lift.damage_material_qty}}</td>
								<td>{{elem_lift.purchase_rate}}</td>
								<td>{{elem_lift.remark}}</td>
							</tr>
						</tbody>
						<tfoot>
							<tr>
								<td class="text-right"><strong>Total</strong></td>
								<td><strong>{{lifting_data | totalsum : 'quantity'}}</strong></td>
								<td colspan="9"></td>
							</tr>

						</tfoot>


					</table>
				</div>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div bsModal #mySplitModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
	aria-hidden="true" [config]="{backdrop:'static'}">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<form [formGroup]="addsplitForm" novalidate (ngSubmit)="onSplitDeal()" autocomplete="off">

				<div class="modal-header">
					<h4 class="modal-title">Split Deal </h4>
					<button type="button" class="close" (click)=" oncloseModal()" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>

				<div class="modal-body">


					<div class="row">


						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="grade_id">Grade</label>
								<ng-select id="grade_id" formControlName="grade_id" placeholder="Select Grade "
									[searchable]="true" [clearable]="true" bindLabel="grade_name" bindValue="grade_id"
									[items]="splitGrades">

									<ng-template ng-option-tmp let-item="item">
										<div title="{{item.grade_name}}">{{item.grade_name}}
										</div>
									</ng-template>
								</ng-select>

							</div>
						</div>


						<div class="col-md-3">
							<div class="form-group">
								<label class="col-form-label" for="extra_quantity"> Quantity</label>
								<input type="text" class="form-control" id="extra_quantity" formControlName="quantity"
									placeholder="Enter   Quantity " numbersOnly>
							</div>
						</div>
					</div>

					<div class="row m-1">

						<div class="col">
							<label class="col-form-label" for="">Email</label>
							<p-chips formControlName="emailMult" separator=",">
							</p-chips>

						</div>


						<div class="col">
							<label class="col-form-label" for="">Contact</label>
							<p-chips formControlName="mobileMult" separator=",">
							</p-chips>
						</div>


					</div>
				</div>



				<div class="modal-footer">
					<button class="btn btn-primary mr-1" type="submit">
						<i class="fa fa-dot-circle-o"></i>Submit</button>
				</div>
			</form>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div bsModal #myQtyKnockofModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
	aria-hidden="true" [config]="{backdrop:'static'}">
	<div class="modal-dialog modal-sm" role="document">
		<div class="modal-content">
			<form [formGroup]="knockOfQtyForm" novalidate (ngSubmit)="onSubmitKnockOffQty()" autocomplete="off">

				<div class="modal-header">
					<h4 class="modal-title">Knock Of Qty</h4>
					<button type="button" class="close" (click)=" oncloseModal()" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>

				<div class="modal-body">


					<div class="row">

						<div class="col-md-12">
							<div class="form-group">
								<label class="col-form-label" for="knock_of_qty">Quantity to Knock of <span style="color: red
								"> It cant be more than lifting remaining quantity</span></label>
								<input type="text" class="form-control" id="knock_of_qty" formControlName="knock_of_qty"
									placeholder="Knock Of Quantity" (change)="checkQtyKnockof()" numbersOnly>
							</div>
						</div>
					</div>
				</div>



				<div class="modal-footer">
					<button class="btn btn-primary mr-1" type="submit">
						<i class="fa fa-dot-circle-o"></i>Submit</button>
				</div>
			</form>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<div bsModal #updateModeModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
	aria-hidden="true" [config]="{backdrop:'static'}">
	<div class="modal-dialog modal-sm" role="document">
		<div class="modal-content">


			<div class="modal-header">
				<h4 class="modal-title">Update Mode Of Payment</h4>
				<button type="button" class="close" (click)=" oncloseModal()" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>

			<div class="modal-body">


				<div class="row">

					<div class="col-md-12">
						<div class="form-group">
							<label class="col-form-label" for="mode_of_payment">Mode Of Payment</label>
							<ng-select id="mode_of_payment" placeholder="Select Term " [searchable]="true"
								[clearable]="true" bindLabel="label" bindValue="id" [items]="paymentMethod"
								[(ngModel)]="modeOfPayment" [multiple]=true>
							</ng-select>
						</div>
					</div>
				</div>
			</div>



			<div class="modal-footer">
				<button class="btn btn-primary mr-1" type="button" (click)="submitModeOfPayment()">
					<i class="fa fa-dot-circle-o"></i>Submit</button>
			</div>

		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->